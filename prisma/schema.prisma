generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Site {
  id           Int        @id @default(autoincrement())
  name         String
  url          String
  color        String     @default("#6B7280")
  parserType   String     @map("parser_type")
  parserConfig String?    @map("parser_config")
  cronInterval String     @default("0 */6 * * *") @map("cron_interval")
  isActive     Boolean    @default(true) @map("is_active")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  articles  Article[]
  crawlLogs CrawlLog[]

  @@map("sites")
}

model Article {
  id          Int       @id @default(autoincrement())
  siteId      Int       @map("site_id")
  externalUrl String    @unique @map("external_url")
  title       String
  publishedAt DateTime? @map("published_at")
  imageUrl    String?   @map("image_url")
  rawContent  String?   @map("raw_content")
  summaryJa       String?   @map("summary_ja")
  detailSummaryJa String?   @map("detail_summary_ja")
  category        String    @default("news")
  isNew       Boolean   @default(true) @map("is_new")
  isFavorited Boolean   @default(false) @map("is_favorited")
  likeCount   Int       @default(0) @map("like_count")
  detectedAt  DateTime  @default(now()) @map("detected_at")
  createdAt   DateTime  @default(now()) @map("created_at")

  site     Site             @relation(fields: [siteId], references: [id])
  views    ArticleView[]
  comments ArticleComment[]

  @@map("articles")
}

model ArticleComment {
  id        Int      @id @default(autoincrement())
  articleId Int      @map("article_id")
  text      String
  createdAt DateTime @default(now()) @map("created_at")

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@map("article_comments")
}

model ArticleView {
  id        Int      @id @default(autoincrement())
  articleId Int      @map("article_id")
  viewedAt  DateTime @default(now()) @map("viewed_at")

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId, viewedAt])
  @@map("article_views")
}

model CrawlLog {
  id            Int       @id @default(autoincrement())
  siteId        Int       @map("site_id")
  status        String
  articlesFound Int       @default(0) @map("articles_found")
  newArticles   Int       @default(0) @map("new_articles")
  errorMessage  String?   @map("error_message")
  startedAt     DateTime  @map("started_at")
  finishedAt    DateTime? @map("finished_at")
  durationMs    Int?      @map("duration_ms")

  site Site @relation(fields: [siteId], references: [id])

  @@map("crawl_logs")
}
